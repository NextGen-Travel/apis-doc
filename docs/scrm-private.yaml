openapi: 3.0.1

info:
  title: SCRM FOR SSO API
  version: 1.0.0

servers:
  - url: https://scrm-api-dev.cloudsatlas.com.hk/api
    description: dev server
  - url: http://localhost:11338/api
  - url: https://nss-dev.cloudsatlas.com.hk/api
    description: nss 導購用api


components:
  securitySchemes:
    client:
      in: header
      type: apiKey
      name: Authorization
      description: 驗證需要的 token, Bearer xxx
  schemas:

    AutoReplies:
      type: array
      items:
        type: object
        required:
          - id
          - replyText
          - keyword
          - children
          - isActive
        properties:
          id:
            type: number
          replyText:
            type: string
          keyword:
            type: string
          isEnd:
            type: boolean
          isActive:
            type: boolean
          children:
            type: array
            description: 遞迴
            items: 
              type: object
              required:
                - id
                - replyText
                - keyword
                - children
                - isActive
              properties:
                id:
                  type: number
                replyText:
                  type: string
                keyword:
                  type: string
                isEnd:
                  type: boolean
                isActive:
                  type: boolean
                children: 
                  type: array
                  items:
                    type: object
                    description: 遞迴
            
    QuickReplies:
      type: object
      required:
        - group
        - isActive
        - children
      properties:
        id:
          type: number
        group:
          type: string
        isActive:
          type: boolean
        children:
          type: array
          items:
            type: object
            required:
              - "replyText"
            properties:
              id:
                type: number
              replyText:
                type: string
    ButtonItem:
      type: object
      required:
        - type
        - text
      properties:
        type:
          type: string
          enum: ['QUICK_REPLY', 'PHONE_NUMBER', 'URL']
        text:
          type: string
        url:
          type: string
          nullable: true
        phone_number:
          type: string
          nullable: true
    TemplateMessageComponent:
      type: object
      required:
        - type
        - text
      properties:
        type:
          type: string
          enum: ['HEADER', 'BODY', 'FOOTER', 'BUTTONS']
        text:
          type: string
        format:
          type: string
          enum: ['TEXT', 'IMAGE', 'DOCUMENT', 'VIDEO']
          nullable: true
        example:
          type: object
          nullable: true
          oneOf:
            - type: object
              properties:
                header_url:
                  type: array
                  items:
                    type: string
            - type: object
              properties:
                body_text:
                  type: array
                  items:
                    type: array
                    items:
                      type: string
            - type: array
              items:
                type: string
        buttons:
          nullable: true
          type: array
          items:
            $ref: '#/components/schemas/ButtonItem'

    Languages:
      type: object
      additionalProperties:
        type: string
  
    Language:
      type: object
      required:
        - id
        - language
        - rejectedReason
        - status
        - createdAt
        - updatedAt
        - components
      properties:
        id:
          type: string
        language:
          $ref: '#/components/schemas/Languages'
        rejectedReason:
          type: string
        status:
          type: string
          enum: ['NEW','APPROVED','PENDING','REJECTED','PENDING_DELETION','DELETED']
        createdAt:
          type: string
        updatedAt:
          type: string
        components:
          type: array
          $ref: '#/components/schemas/TemplateMessageComponent'
        namespace:
          type: string
        wabaId:
          type: string
        category:
          type: string
          enum: ['OTP','TRANSACTIONAL','MARKETING']
        name:
          type: string
    TemplateMessageItems:
      type: object
      properties:
        category:
          type: string
          enum: [OTP,TRANSACTIONAL,MARKETING]
        name:
          type: string
        namespace:
          type: string
        wabaId:
          type: string
        languages:
          type: array
          $ref: '#/components/schemas/Language'
    TemplateMessage:
      type: object
      properties:
        count:
          type: number
        items:
          type: array
          items:
            $ref: '#/components/schemas/TemplateMessageItems'
        limit:
          type: number
        offset: 
          type: number
        totalCount: 
          type: number
    NSS:
      type: object
      properties:
        name:
          type: string
        currency:
          type: string
        price:
          type: string
        slug:
          type: string
        stock:
          type: boolean
        url:
          type: string
        image:
          type: string
    UserProcessStatus:
      type: object
      required:
        - averageProcessTime
        - averageWaitingTime
        - completed
        - processing
        - shoppingLinkEventCount
        - username
        - waiting
      properties:
        averageProcessTime:
          type: number
        averageWaitingTime:
          type: number
        completed:
          type: number
        processing:
          type: number
        shoppingLinkEventCount:
          type: number
        username:
          type: string
        waiting:
          type: number
        tbColor:
          type: string
    UserProcessStatusFields:
      type: object
      properties:
        key:
          type: string
          enum:
            - averageProcessTime
            - averageWaitingTime
            - completed
            - processing
            - shoppingLinkEventCount
            - username
            - waiting
            - tbColor
        label:
          type: string
    Fields:
      type: object
      properties:
        key:
          type: string
        label:
          type: string
    UserProcessList:
      type: object
      required:
        - customer
        - date
        - startedAt
        - phone
        - processTime
        - status
        - username
      properties:
        customer:
          type: string
        date:
          type: string
        startedAt:
          type: string
        endedAt:
          type: string
        tag:
          type: string
        shoppingLinkCnt:
          type: number
        phone:
          type: string
        processTime:
          type: number
        status:
          type: string
        username:
          type: string
        tbColor:
          type: string
    UserProcessListFields:
      type: object
      properties:
        key:
          type: string
          enum:
            - customer
            - date
            - startedAt
            - endedAt
            - tag
            - shoppingLinkCnt
            - phone
            - processTime
            - status
            - username
            - tbColor
        label:
          type: string
    QuestionType:
      type: object
      properties:
        totalCount:
          type: string
    QuestionTypeFields:
      type: object
      properties:
        key:
          type: string
          enum:
            - totalCount
        label:
          type: string
    

        
    
paths:

  # ====================
  #
  # User
  #

  /admin/users/{id}:
    put:
      summary: 更新任一客服資料
      description: 更新任一客服資料
      tags:
        - users
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1        
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required: []
              properties:
                password:
                  type: string
                  example: 123456789
                  description: 客服密碼
                confirmPassword:
                  type: string
                  example: 123456789
                  description: 客服密碼
                displayName:
                  type: string
                  example: TJ
                  description: 客服前台顯示名稱
                confirmed:
                  type: boolean
                  example: 1
                  description: 啟用 || 停用
                avatar  :  
                  type: string
                  format: binary
                  description: 客服大頭貼 
                phone: 
                  type: string
                  example: 123456789
                  description: 電話
                notes:
                  type: string
                  example: test
                  description: 備註
                roleName:
                  type: string
                  example: Manager
                  description: 員工權限（ Manager || Advanced-Staff || Staff )

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      email:
                        type: string
                      displayName:
                        type: string
                      username:
                        type: string
                      confirmed:
                        type: boolean
                      phone:
                        type: string
                      notes:
                        type: string
                      blocked:
                        type: boolean
                      avatar:
                        type: string
                      role:
                        type: string
                      company:
                        type: number

  /admin/delete/users/{id}:
    put:
      summary: 刪除特定客服資料
      description: 刪除特定客服資料（管理者權限才可使用）
      tags:
        - users
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  description: 刪除使用者需要輸入登入者的密碼驗證身份
              required:
                - password
    
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  /users:
    get: 
      summary: 取得所有與登入者同company的客服資料
      description: 取得所有與登入者同company的客服資料
      tags:
        - users
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        username:
                          type: string
                        displayName:
                          type: string
                        avatar:
                          type: string
                        confirmed:
                          type: boolean
                          description: true表示啟用反之為停用
                        role:
                          type: string
    post:
      summary: 創建客服（管理者權限才可使用）
      description: 管理者創建新客服
      tags:
        - users
      security:
        - client: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: 客服帳號名稱
                email:
                  type: string
                  example: 123@123.com
                  description: 客服信箱
                password:
                  type: string
                  example: 123456789
                  description: 客服密碼
                confirmPassword:
                  type: string
                  example: 123456789
                  description: 客服密碼
                displayName:
                  type: string
                  example: TJ
                  description: 客服前台顯示名稱  
                avatar  :  
                  type: string
                  format: binary
                  description: 客服大頭貼
                phone:
                  type: string
                  description: 電話
                notes:
                  type: string        
                  description: 備註     
                role:
                  type: string
                  example: staff
                  description: 員工權限（ superadmin || seniorStaff || staff )  
                companyId:
                  type: number
                  example: 5
                  description: 隸屬公司ID(若沒帶則預設為登入者的公司ID, superadmin新建客服時必須要帶)

              required:
                - username
                - email
                - password
                - confirmPassword
                - role

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      email:
                        type: string
                      displayName:
                        type: string
                      username:
                        type: string
                      confirmed:
                        type: boolean
                      phone:
                        type: string
                      notes:
                        type: string
                      blocked:
                        type: boolean
                      avatar:
                        type: string
                      role:
                        type: string
                      company:
                        type: number

        '500':
          description: 伺服器錯誤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  伺服器錯誤
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  建立失敗                              
  
  /users/me:
    get:
      description: 取得使用者個人資料
      security:
        - client: []
      tags: 
        - users
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      user:
                        type: object
                        properties:
                          id:
                            type: number
                          email:
                            type: string
                          displayName:
                            type: string
                          username:
                            type: string
                          confirmed:
                            type: boolean
                          phone:
                            type: string
                          notes:
                            type: string
                          blocked:
                            type: boolean
                          avatar:
                            type: string
                          role:
                            type: string
                          company:
                            type: number
                      platform:
                          type: array
                          description: 該使用者所屬公司有開啟的社群平台帳號（superadmin不會有）
                          items:
                            type: object
                            properties:
                              platform:
                                type: string
                              account:
                                type: object
                              enable:
                                type: boolean

  /users/{id}:
   get:
      summary: 查詢特定客服資料
      description: 查詢特定客服資料(僅superadmin及admin可使用該api)
      tags:
        - users
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      email:
                        type: string
                      displayName:
                        type: string
                      username:
                        type: string
                      confirmed:
                        type: boolean
                      phone:
                        type: string
                      notes:
                        type: string
                      blocked:
                        type: boolean
                      avatar:
                        type: string
                      role:
                        type: string
                      company:
                        type: number

   put:
      summary: 更新客服資料（登入者自己）
      description: 更新客服資料（登入者自己）
      tags:
        - users
      security:
        - client: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                password:
                  type: string
                  example: 123456789
                  description: 客服密碼
                confirmPassword:
                  type: string
                  example: 123456789
                  description: 客服密碼
                displayName:
                  type: string
                  example: TJ
                  description: 客服前台顯示名稱  
                avatar  :  
                  type: string
                  format: binary
                  description: 客服大頭貼 
                phone:
                  type: string
                  example: 123456789
                  description: 電話
                notes:
                  type: string
                  example: test
                  description: 備註

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      email:
                        type: string
                      username:
                        type: string
                      displayName:
                        type: string
                      phone:
                        type: string
                      notes:
                        type: string
                      avatar:
                        type: string
                      role:
                        type: string

  # ====================
  #
  # Company
  #
  /companies:
    get:
      summary: 查詢公司資料
      description: 查詢公司資料
      tags:
        - company
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        name:
                          type: string

    post:
      summary: 創建公司（superadmin權限才可使用）
      description: 創建公司（superadmin權限才可使用）
      tags:
        - company
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                enable:
                  type: boolean
                  description: 開啟與否(預設為false)
                name:
                  type: string
                  example: nextgenTest
                  description: 創建公司名稱（唯一值）
                platform:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: whatsapp
                        description: 社交平台名稱 (若有name則必須有account & channelId)
                      account:
                        type: string
                        example: whatsappId123456
                        description: 該社交平台的帳號 (account 必須與 channelId同時存在)
                      channelId:
                        type: string
                        example: test123-wafds-vv654
                      enable:
                        type: boolean
                        example: true
                sso:
                  type: object
                  items:
                    properties:
                      appId:
                        type: string
                        example: R546asd-+qwew
                      secretKey:
                        type: string
                        example: as4d123xcv-as46gg
                accountLimit:
                  type: number
                  example: 5
                  description: 建立客服的數量限制(預設是1)

              required:
                - name

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                  msg:
                    type: string      
                    example: 建立成功

  /companies/list:
    get:
      summary: superadmin查詢所有公司資料
      description: superadmin查詢所有公司資料
      tags:
        - company
      security:
        - client: []  
      parameters:
        - in: query
          name: enable
          schema:
            type: string
          required: false
        - in: query
          name: sso
          schema:
            type: string
          required: false  
        - in: query
          name: offset
          schema:
            type: number
          required: false   
        - in: query
          name: limit
          schema:
            type: number
          required: false 
        - in: query
          name: platform
          schema:
            type: string
          required: false           
        - in: query
          name: keyword
          required: false
          description: 搜尋公司名稱
          schema:
            type: string                           
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          description: 公司ID
                        name:
                          type: string
                          description: 公司名稱
                        platform:
                          type: array
                          items:
                            type: string
                            description: 公司社群平台
                        accountCount:
                          type: number
                          description: 當前已開啟的客服數量
                        accountLimit:
                          type: number
                          description: 公司的客服開啟上限
                        sso:
                          type: boolean
                          description: sso設定是否開啟
                        enable:
                          type: boolean
                          description: 公司狀態
                  total:
                    type: number
                  
  /companies/{id}:
    get:
      summary: 查詢特定公司資料
      description: 查詢特定公司資料
      tags:
        - company
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      enable:
                        type: boolean
                      name:
                        type: string
                      accountLimit:
                        type: number
                      sso:
                        type: object
                        properties:
                          appId:
                            type: string
                          secretKey:
                            type: string
                          enable: 
                            type: boolean
                      keys:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            account:
                              type: string
                            platform:
                              type: string
                            channelId:
                              type: string
                            enable: 
                              type: boolean
    put:
      summary: 更新公司（superadmin權限才可使用）
      description: 更新公司（superadmin權限才可使用）
      tags:
        - company
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                enable:
                  type: boolean
                  description: 開啟與否
                name:
                  type: string
                  example: nextgenTest
                  description: 創建公司名稱（唯一值）
                platform:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: number
                        example: 1
                        description: 平台對應的ID
                      name:
                        type: string
                        example: whatsapp
                        description: 開啟的社交平台名稱 (若有name則必須有account & channelId)
                      account:
                        type: string
                        example: whatsappId123456
                        description: 該社交平台的帳號 (account 必須與 channelId同時存在)
                      channelId:
                        type: string
                        example: test123-wafds-vv654
                      enable:
                        type: boolean
                        example: true
                    required:
                      - name
                      - account
                      - channelId
                      - enable
                sso:
                  type: object
                  properties:
                    appId:
                      type: string
                      example: R546asd-+qwew
                    secretKey:
                      type: string
                      example: as4d123xcv-as46gg
                    enable:
                      type: boolean
                      example: true
                accountLimit:
                  type: number
                  example: 5
                  description: 建立客服的數量限制

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string               
                    example: 更新成功

  /companies/{id}/users:
    get:
      summary: 查詢特定公司底下所有使用者資料
      description: 查詢特定公司底下所有使用者資料
      tags:
        - company
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1
        - in: query
          name: offset
          schema:
            type: number
          required: false   
        - in: query
          name: limit
          schema:
            type: number
          required: false 

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        username:
                          type: string
                        displayName:
                          type: string
                        email: 
                          type: string
                        phone:
                          type: string
                        notes:
                          type: string
                        avatar:
                          type: string
                        role:
                          type: string
                        enable:
                          type: boolean
                  total:
                    type: number
                  enableQty:
                    type: number
                  disableQty:
                    type: number

  /companies/{id}/delete:
    put:
      summary: 刪除特定公司資料 （軟刪除）
      description: 刪除特定客服資料（superadmin權限才可使用）
      tags:
        - company
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  description: 刪除使用者需要輸入登入者的密碼驗證身份
              required:
                - password
    
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: 刪除成功！

  /companies/sync: 
    post:
      summary: 創建公司時驗證appId取得secretKey及是否開啟sso(enable)client端
      description: 創建公司時驗證appId取得secretKey及是否開啟sso(enable)client端
      tags:
        - company
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                appId:
                  type: string
                  description: 該公司appId
              required:
                - appId

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      enable:
                        type: boolean
                      secretKey:
                        type: string

  /companies/sync/cas: 
    post:
      summary: 供cas中控系統同步之api (server端)
      description: 供cas中控系統同步之api (server端)
      tags:
        - company
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: 加密過後的資料
              required:
                - code

      responses:
        '200':
          description: 成功
  # ====================
  #
  # 自動回覆設定
  #
  /auto-replies:
    get: 
      summary: 取得自動回覆整顆樹
      description: 取得自動回覆整顆樹
      tags:
        - auto-replies
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Suucess
                  data:
                    $ref: '#/components/schemas/AutoReplies'
    post:
      summary: 儲存自動回覆
      description: 儲存自動回覆
      tags:
        - auto-replies
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - parent
              properties:
                parent:
                  type: number
                keyword:
                  type: string
                replyText:
                  type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                      $ref: '#/components/schemas/AutoReplies'

  /auto-replies/all:
    put:
      summary: 編輯樹根或樹葉用的
      description: 編輯樹根或樹葉用的
      tags:
        - auto-replies
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items: 
                type: object
                properties:
                  id:
                    type: number
                  replyText:
                    type: string
                  keyword:
                    type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    type: array
                    items: 
                      $ref: '#/components/schemas/AutoReplies'

  /auto-reply/welcome:
    get: 
      summary: 取得歡迎訊息
      description: 取得歡迎訊息
      tags:
        - auto-replies
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      replyText:
                        type: string
    put:
      summary: 更新歡迎訊息
      description: 取得歡迎訊息
      tags:
        - auto-replies
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                replyText:
                  type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
  /auto-replies/{id}:
    put:
      summary: 更新該樹節點是否啟用
      description: 更新該樹節點是否啟用
      tags:
        - auto-replies
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isActive:
                  type: boolean
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
    delete:
      summary: 刪除該樹節點
      description: 刪除該樹節點
      tags:
        - auto-replies
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    type: array
                    items: 
                      $ref: '#/components/schemas/AutoReplies'
  # ====================
  #
  # 快捷回覆
  #
  /quick-replies:
    get: 
      summary: 取得快捷回覆
      description: 取得快捷回覆
      tags:
        - quick-replies
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QuickReplies'
  /quick-replies/groups:
    post:
      summary: 新增群組名稱
      description: 新增群組名稱
      tags:
        - quick-replies
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                group:
                  type: string
                children:
                  type: array
                  items:
                    type: object
                    properties:
                      replyText:
                        type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    $ref: '#/components/schemas/QuickReplies'
  /quick-replies/groups/{groupId}:
    put:
      summary: 更新該群組名稱底下快捷訊息
      description: 新增群組名稱
      tags:
        - quick-replies
      security:
        - client: []
      parameters:
        - in: path
          name: groupId
          schema:
            type: number
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                group:
                  type: string
                children:
                  type: array
                  items:
                    type: object
                    properties:
                      replyText:
                        type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    $ref: '#/components/schemas/QuickReplies'
  /quick-replies/{id}:
    put:
      summary: 更新群組名稱是否啟用
      description: 更新群組名稱是否啟用
      tags:
        - quick-replies
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                isActive:
                  type: boolean
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
    delete:
      summary: 刪除群組名稱或快捷訊息
      description: 刪除該樹節點
      tags:
        - quick-replies
      security:
        - client: []
      parameters:
        - in: path
          name: id
          schema:
            type: number
          required: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
  # ====================
  #
  # 設定範本
  # 有串了messagebird
  /messagebird/templates:
    get: 
      summary: 取得範本
      description: 取得範本
      tags:
        - templates
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                      $ref: '#/components/schemas/TemplateMessage'
    post:
      summary: 新增範本
      description: 新增範本
      tags:
        - templates
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                language:
                  $ref: '#/components/schemas/Languages'
                name:
                  type: string
                category:
                  type: string
                  enum:
                    - OTP
                    - TRANSACTIONAL
                    - MARKETING
                components:
                  type: array
                  items:
                    $ref: '#/components/schemas/TemplateMessageComponent'

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      language:
                        $ref: '#/components/schemas/Languages'
                      status:
                        type: string
                        enum: ['NEW','APPROVED','PENDING','REJECTED','PENDING_DELETION','DELETED']
                      wabaId:
                        type: string
                      namespace:
                        type: string
                      components:
                        type: array
                        items:
                          $ref: '#/components/schemas/TemplateMessageComponent'
  /messagebird/templates/{templateName}/:
    get: 
      summary: 取得特定範本
      description: 取得特定範本
      tags:
        - templates
      security:
        - client: []
      parameters:
        - in: path
          name: templateName
          schema:
            type: string
          required: true
        - in: query
          name: wabaId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                      $ref: '#/components/schemas/Language'
    delete:
      summary: 刪除範本
      description: 刪除範本
      tags:
        - templates
      security:
        - client: []
      parameters:
        - in: path
          name: templateName
          schema:
            type: string
          required: true
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
  # ====================
  #
  # 導購商品的api
  # 串nss系統
  /category:
    get: 
      summary: 取得nss商品目錄
      description: 取得nss商品目錄
      tags:
        - nss
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                     type: object
                     properties:
                      type:
                        type: string
                      total:
                        type: number
                      title:
                        type: number
                      products:
                        type: array
                        items: 
                          $ref: '#/components/schemas/NSS'

  /category/{type}:
    get: 
      summary: 取得nss特定類型的商品
      description: 取得nss特定類型的商品
      tags:
        - nss
      security:
        - client: []
      parameters:
        - in: query
          name: page
          schema:
            type: number
        - in: query
          name: search
          schema:
            type: string
        - in: path
          name: type
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                     type: object
                     properties:
                      type:
                        type: string
                      total:
                        type: number
                      title:
                        type: number
                      products:
                        type: array
                        items: 
                          $ref: '#/components/schemas/NSS'
  # ====================
  #
  # 分析報表
  # 
  /report/overview:
    get: 
      summary: 取得報表分析資料
      description: 取得報表分析資料
      tags:
        - report
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          type: string
                      data:
                        type: array
                        items:
                          type: object
                          additionalProperties:
                            type: number
  /report/user-process-status:
    get: 
      summary: 取得各客服人員處理狀況資料
      description: 取得各客服人員處理狀況資料
      tags:
        - report
      security:
        - client: []
      parameters:
        - name: startDate
          in: query
          required: true
          schema:
            type: string
        - name: endDate
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: true
          schema:
            type: number
        - name: offset
          in: query
          required: true
          schema:
            type: number
        - name: selectedUsers
          in: query
          schema:
            type: string
            example: 1,2,3
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      table:
                        type: object
                        properties:
                          fullCount:
                            type: number
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessStatusFields'
                          items:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessStatus'
                      total:
                        type: object
                        properties:
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessStatusFields'
                          items:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessStatus'
                  msg:
                    type: string
                    example: Success
  /report/tags:
    get: 
      summary: 取得客戶標籤歸類資料
      description: 取得客戶標籤歸類資料
      tags:
        - report
      security:
        - client: []
      parameters:
        - name: limit
          in: query
          required: true
          schema:
            type: number
        - name: offset
          in: query
          required: true
          schema:
            type: number
        - name: startDate
          in: query
          required: true
          schema:
            type: string
        - name: endDate
          in: query
          required: true
          schema:
            type: string
        - name: selectedTags
          in: query
          schema:
            type: string
            example: 1,2,3
        - name: selectedUsers
          in: query
          schema:
            type: string
            example: 1,2,3
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      table:
                        type: object
                        properties:
                          fields:
                            type: array
                            items: 
                              $ref: '#/components/schemas/Fields'
                          fullCount:
                            type: number 
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                customer:
                                  type: string
                                date:
                                  type: string
                                phone:
                                  type: string
                                tag:
                                  type: string
                                username:
                                  type: string
                      chartData:
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            value:
                              type: number
                  msg:
                    type: string
                    example: Success
  /report/user-process-list:
    get: 
      summary: 取得客服的分析資料資料
      description: 取得客服的分析資料資料
      tags:
        - report
      security:
        - client: []
      parameters:
        - name: limit
          in: query
          required: true
          schema:
            type: number
        - name: offset
          in: query
          required: true
          schema:
            type: number
        - name: startDate
          in: query
          required: true
          schema:
            type: string
        - name: endDate
          in: query
          required: true
          schema:
            type: string
        - name: selectedUsers
          in: query
          schema:
            type: string
            example: 1,2,3
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      table:
                        type: object
                        properties:
                          fullCount:
                            type: number
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessListFields'
                          items:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessList'
                      total:
                        type: object
                        properties:
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessListFields'
                          items:
                            type: array 
                            items:
                              $ref: '#/components/schemas/UserProcessList'
                  msg:
                    type: string
                    example: Success
  /question-types:
    get: 
      summary: 客服問題歸類-select框的選項
      description: 客服問題歸類-select框的選項
      tags:
        - report
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
               type: object
               properties:
                msg:
                  type: string
                  example: Success
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: number
                      keyword:
                        type: string
  /report/question-type:
    get: 
      summary: 取得客服問題歸類資料
      description: 取得客服問題歸類資料
      tags:
        - report
      security:
        - client: []
      parameters:
        - name: limit
          in: query
          required: true
          schema:
            type: number
        - name: offset
          in: query
          required: true
          schema:
            type: number
        - name: startDate
          in: query
          required: true
          schema:
            type: string
        - name: endDate
          in: query
          required: true
          schema:
            type: string
        - name: selectedQuestionTypes
          in: query
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: object
                    properties:
                      table:
                        type: object
                        properties:
                          fullCount:
                            type: number
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/Fields'
                          items:
                            type: array 
                            items:
                              type: object
                              required:
                                - name
                                - count
                              properties:
                                name:
                                  type: string
                                count:
                                  type: string
                                tbColor:
                                  type: string 
                      chartData:
                        type: array 
                        items:
                          type: object
                          properties:
                            name:
                              type: string
                            value:
                              type: number
                      total:
                        type: object
                        properties:
                          fields:
                            type: array 
                            items:
                              $ref: '#/components/schemas/QuestionTypeFields'
                          items:
                            type: array 
                            items:
                              $ref: '#/components/schemas/QuestionType'
  /question-types/others:
    get: 
      summary: 取得客服問題歸類-其他類
      description: 取得客服問題歸類-其他類
      tags:
        - report
      security:
        - client: []
      parameters:
        - name: startDate
          in: query
          required: true
          schema:
            type: string
        - name: endDate
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/Fields'
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            count:
                              type: string
                            name:
                              type: string
                      detailFields:
                        type: array
                        items:
                          $ref: '#/components/schemas/Fields'
                      detailItems:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                            note:
                              type: string
                            username:
                              type: string
  # ====================
  #
  # 訊息
  # 
  /customers/{customerUuid}/messages:
    get: 
      summary: 取得對話紀錄
      description: 取得對話紀錄
      tags:
        - customers
      security:
        - client: []
      parameters:
        - name: customerUuid
          in: path
          required: true
          schema:
            type: string
            example: 0816a550-f53e-42a1-880d-c23b054cbe23
        - name: start
          in: query
          required: true
          schema:
            type: number
            example: 0
        - name: limit
          in: query
          required: true
          schema:
            type: number
            example: 100
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: object
                    properties:
                      isCaseOpened:
                        description: '用來判斷此次對話是否結束，以便分析報表資料用途'
                        type: boolean
                      messages:
                        type: array
                        items:
                          type: object
                          properties:
                            customerUuid:
                              type: string
                            direction:
                              type: string
                              enum: ['received','sent']
                            id:
                              type: number
                            status:
                              type: string
                              enum: ['sent' , 'read' , 'delivered' , 'failed']
                            text:
                              type: string
                            timestamp:
                              type: string
                            type:
                              type: string
                              enum: ['text' , 'hsm' , 'image' , 'file' , 'audio' , 'video' , 'whatsappSticker']
                            user:
                              type: object
                              properties:
                                id:
                                  type: number
                                displayName:
                                  type: string
                                avatar:
                                  type: string
                            file:
                              nullable: true
                              type: object
                              properties:
                                url:
                                  nullable: true
                                  type: string
                                caption:
                                  nullable: true
                                  type: string
                                size:
                                  nullable: true
                                  type: string
                                extension:
                                  nullable: true
                                  type: string
                            components:
                              nullable: true
                              type: array
                              items:
                                $ref: '#/components/schemas/TemplateMessageComponent'
    post:
      summary: 傳送聊天訊息，包含錄音,圖片,文件,範本
      description: 儲存自動回覆
      tags:
        - customers
      security:
        - client: []
      parameters:
        - name: customerUuid
          in: path
          required: true
          schema:
            type: string
            example: 0816a550-f53e-42a1-880d-c23b054cbe23
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - userId
                - type
              properties:
                userId:
                  type: number
                type:
                  type: string
                  enum: ['audio','image','file','text','hsm']
                  description: hsm是傳送範本類型的型態
                text:
                  type: string
                  oneOf:
                    - type: string
                    - type: object
                      properties:
                        components:
                          type: array
                          items:
                            $ref: '#/components/schemas/TemplateMessageComponent'
                caption: 
                  type: string
                files:
                  type: string
                  format: binary
                  description: The file to be uploaded
                templateName:
                  type: string
                languageCode:
                  type: string
                isShoppingLink:
                  type: boolean
                  description: 導購紀錄
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
  /chats:
    get: 
      summary: 取得左邊列表
      description: 取得左邊列表
      tags:
        - customers
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        lastMsg:
                          type: string
                        status:
                          type: string
                          enum: ['sent' , 'read' , 'delivered' , 'failed']
                        timestamp:
                          type: string
                        unreadCount:
                          type: number
                        isPin:
                          type: boolean
                        customer:
                          type: object
                          required:
                            - customerUuid
                            - id
                            - phone
                            - remark
                            - tags
                            - platform
                          properties:
                            customerUuid:
                              type: string
                            id:
                              type: number
                            phone:
                              type: string
                            remark:
                              type: string
                            active:
                              type: string
                            colorCode:
                              type: number
                            platform:
                              type: string
                              enum: ['whatsapp','wechat','facebook','instagram','telegram']
                            tags:
                              type: array
                              items:
                                type: number
                            
  /groups:
    get: 
      summary: 取得頭像的顏色
      description: 用來設定客人頭像的顏色
      tags:
        - customers
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        colorCode:
                          type: string
  /tags:
    get: 
      summary: 取得所有標籤
      description: 用來mapping全域標籤
      tags:
        - customers
      security:
        - client: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        tagName:
                          type: string
    post:
      summary: 更新全域標籤
      description: 更新全域標籤
      tags:
        - customers
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tagName
              properties:
                tagName:
                  type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  id:
                    type: number
                  tagName:
                    type: string
                  
  /tags/{id}:
    delete:
      summary: 刪除全域標籤
      description: 刪除全域標籤
      tags:
        - customers
      security:
        - client: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: number
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
  /customers/messages:
    post:
      summary: 群發
      description: 群發
      tags:
        - customers
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - type
                - customerUuid
                - text
              properties:
                customerUuid:
                  type: string
                  example: customerUuid,customerUuid
                userId:
                  type: number
                type:
                  type: string
                  example: text
                  description: 群發只會有text型態
                text:
                  type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string                   
                    example: Success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        lastMsg:
                          type: string
                        status:
                          type: string
                        timestamp:
                          type: string
                        unreadCount:
                          type: number
                        customer:
                          type: object
                          properties:
                            customerUuid:
                              type: string
                            id:
                              type: number
                            phone:
                              type: string
                            remark:
                              type: string
  /customers/{customerUuid}/pin:
    put:
      summary: 更新置頂
      description: 更新置頂
      tags:
        - customers
      security:
        - client: []
      parameters:
        - name: customerUuid
          in: path
          required: true
          schema:
            type: string
            example: 0816a550-f53e-42a1-880d-c23b054cbe23
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - isPin
              properties:
                isPin:
                  type: boolean
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
  /customers/{customerUuid}:
    put:
      summary: 更新客人資訊
      description: 更新客人資訊
      tags:
        - customers
      security:
        - client: []
      parameters:
        - name: customerUuid
          in: path
          required: true
          schema:
            type: string
            example: 0816a550-f53e-42a1-880d-c23b054cbe23
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - isPin
                - remark
                - colorCode
              properties:
                tags:
                  type: array
                  items:
                    type: number
                    example: 5,3
                remark:
                  type: string
                colorCode:
                  type: number
                  example: 6
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        lastMsg:
                          type: string
                        status:
                          type: string
                        timestamp:
                          type: string
                        unreadCount:
                          type: number
                        customer:
                          type: object
                          properties:
                            customerUuid:
                              type: string
                            id:
                              type: number
                            phone:
                              type: string
                            remark:
                              type: string
  /customers/{customerUuid}/process-status:
    put:
      summary: 結束事件
      description: 結束事件
      tags:
        - customers
      security:
        - client: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
                - msgId
                - questionType
              properties:
                status:
                  type: string
                  example: completed
                msgId:
                  type: number
                questionType:
                  type: number
                others:
                  type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success