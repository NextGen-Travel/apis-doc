openapi: 3.0.1

info:
  title: ERP配藥系統API
  version: 1.0.0
  description: ERP配藥系統API相關說明文件

servers:
  - url: http://localhost:8000/project/public/api
  - url: https://pos.cloudsatlas.com.hk/public/api

tags:
  - name: Business
    description: Operations about business
  - name: Transaction
    description: Operations about transaction
  - name: Product
    description: Operations about product
  - name: Contact
    description: Operations about contact

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 驗證需要的token
  parameters:
    language:
      in: header
      name: accept-language
      schema:
        type: string
      required: false
      example: 'en'
  schemas:
    Transaction:
      type: object
      properties:
        contact_id:  # 病人ID
          type: integer
          example: 4
        contact_name:
          type: string
          example: 桂綸鎂
          description: 病人姓名
        doctor_name:
          type: string
          example: 王醫師
          description: 醫生姓名
        hospital_key:
          type: integer
          example: 8
        hospital_name:
          type: string
          example: 中九龍診所
          description: 醫院名稱
        prescription_sign_created_at:
          type: string
          example: 2022-10-20
          description: 配藥日期
        prescription_sign_message:
          type: string
          example: 頭痛
          description: 處方簽症狀
        products:
          type: string
          example: 
        contact_custom_field1:
          type: string
          example: A12345678
          description: 病人身分證字號
        contact_mobile:
          type: string
          example: 0962875124
          description: 病人手機
        contact_custom_field2:
          type: string
          example: M
          description: 病人性別
        contact_dob:
          type: string
          example: 1990/1/20
          description: 病人生日
        contact_custom_field3:
          type: string
          example: 八角
          description: 病人藥物忌諱
        purchase_id:
          type: integer
          example: 8
          description: 購買人 id
        purchase_name:
          type: string
          example: 戴立忍
          description: 購買人姓名
        purchase_mobile:
          type: string
          example: 09937645284
          description: 購買人電話
        purchase_identy_number:
          type: string
          example: B8230185284
          description: 購買人身份證字號
      # Both properties are required
      required:  
        - contact_name
        - contact_custom_field1
    Contact:
      type: object
      properties:
        type:
          type: string
          example: patient
          description: 客戶類型 patient/customer/p_and_c
        accountNo:
          type: string
          example: A12345678
          description: 身分證字號
        address:
          type: string
          example: 九龍灣
          description: 地址
        allergyDrug:
          type: array
          items:
            type: string
          example: [5048, 5059]
          description: 藥物過敏
        drugNote:
          type: array
          items:
            type: string
          example: ['想睡', '肌肉酸痛']
          description: 藥物過敏備註
        allergyIngredient:
          type: array
          items:
            type: string
          example: [2012, 3023]
          description: 主成份過敏 IS
        ingredientNote:
          type: array
          items:
            type: string
          example: ["頭暈", "肌肉酸痛"]
          description: 主成份過敏備註
        birthday:
          type: string
          example: 2022-10-1
          description: 生日
        drugTaBoo:
          type: string
          example: 消炎藥
          description: 藥物忌諱
        email:
          type: string
          example: abcdefg@nextgen.com.hk
          description: 電子信箱
        gender:
          type: string
          example: F
          description: 性別
        mobile:
          type: string
          example: 0911765872
          description: 手機號碼
        name:
          type: string
          example: 桂綸鎂
          description: 姓名
        phoneNumber:
          type: string
          example: 025438762
          description: 電話
      required:
        - type
        - name
    ContactUpdate:
      type: object
      properties:
        accountNo:
          type: string
          example: A12345678
          description: 身分證字號
        address:
          type: string
          example: 九龍灣
          description: 地址
        allergyDrug:
          type: array
          example: []
          description: 過敏藥物
        allergyIngredient:
          type: array
          example: []
        birthday:
          type: string
          example: 2022-10-1
          description: 生日
        drugNote:
          type: string
          example: []
        drugTaBoo:
          type: string
          example: 消炎藥
          description: 藥物忌諱
        email:
          type: string
          example: abcdefg@nextgen.com.hk
          description: 電子信箱
        gender:
          type: string
          example: F
          description: 性別
        ingredientNote:
          type: string
          example: []
        mobile:
          type: string
          example: 0911765872
          description: 手機號碼
        name:
          type: string
          example: 桂綸鎂
          description: 姓名
        phoneNumber:
          type: string
          example: 025438762
          description: 電話
      required:
        - type
        - name

paths:
  /info:
    get:
      summary: Business Location 詳細資訊
      description: 會列出 Location 的詳細資訊
      tags:
        - Business
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      name:
                        type: string
                        example: A藥局
                      mobile:
                        type: string
                        example: 0945761435
                      country:
                        type: string
                        example: 香港
                      state:
                        type: string
                        example: 尖沙嘴頂好北路50巷10號
                      city:
                        type: string
                        example: 九龍
                      zip_code:
                        type: string
                        example: 111
  /on-duty:
    get:
      summary: 值班人員
      description: 取得值班店員與值班藥師資訊
      tags:
        - Business
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      user_id:
                        type: number
                        example: 1
                      user_name:
                        type: string
                        example: A店員
                      pharmacist_id:
                        type: number
                        example: 2
                      pharmacist_name:
                        type: string
                        example: 陳藥劑師
  /transactions:
    get:
      summary: 交易清單
      description: 取得交易清單
      tags:
        - Transaction
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: contactId  # 身分證字號
          schema:
            type: integer
          description: Search contact for transactions
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          example: 180
                        pharmacist_name:
                          type: string
                          example: 陳藥師
                        prescription_sign_message:
                          type: string
                          example: 頭痛
                        username:
                          type: string
                          example: A店員
                        contact_name:
                          type: string
                          example: A病人
                        created_at:
                          type: string
                          example: 2022-10-21 09:33:52
                  links:
                    type: object
                    properties:
                      first:
                        type: string
                      last:
                        type: string
                      prev:
                        type: string
                      next:
                        type: string
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: number
                      from:
                        type: number
                      last_page:
                        type: number
                      path:
                        type: string
                      per_page:
                        type: number
                      to:
                        type: number
                      total:
                        type: number
    post:
      summary: 建立一筆交易.
      tags:
        - Transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Transaction'
      responses:
        '200':
          description: Created
  /transactions/{id}:
    get:
      summary: 單一交易
      description: 取得單一交易資訊
      tags:
        - Transaction
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID of transaction to return
          required: true
          example: 126
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      created_at:
                        type: string
                      contact_id:
                        type: number
                      contact_dob:
                        type: string
                      contact_name:
                        type: string
                      total_amount:
                        type: string
  /transactions/{id}/products:
    get:
      summary: 交易表裡的產品清單
      description: 取得交易表裡的產品清單
      tags:
        - Transaction
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID of transaction to return
          required: true
          example: 126
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        sell_id:
                          type: number
                        quantity:
                          type: number
                        price:
                          type: string
                        usage_id:
                          type: number
                        product_id:
                          type: number
                        days:
                          type: number
                        total:
                          type: number
                        dosage:
                          type: number
                        frequency:
                          type: number
                        cautions:
                          type: array
                          items:
                            type: object
                        custom_caution:
                          type: string
                        dosage_form:
                          type: string
                  links:
                    type: object
                    properties:
                      first:
                        type: string
                      last:
                        type: string
                      prev:
                        type: string
                      next:
                        type: string
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: number
                      from:
                        type: number
                      last_page:
                        type: number
                      path:
                        type: string
                      per_page:
                        type: number
                      to:
                        type: number
                      total:
                        type: number
  /products:
    get:
      summary: 產品清單
      description: "取得產品清單"
      tags:
        - Product
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: keyword
          schema:
            type: string
          description: The keyword for search products
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          description: 藥品 id
                        sku:
                          type: string
                          description: 藥品 SKU
                        name:
                          type: string
                          description: 藥品名稱
                        qty_available:
                          type: number
                          description: 庫存數量
                        alert_quantity:
                          type: string
                          description: 庫存警告數量
                        default_sell_price:
                          type: string
                          description: 售價
                        product_custom_field1:
                          type: string
                          description: 藥品證號
                        product_custom_field2:
                          type: string
                          description: 藥品英文名稱
                        product_custom_field3:
                          type: string
                          description: 藥廠
                        product_custom_field4:
                          type: string
                          description: 藥品主成份
                  links:
                    type: object
                    properties:
                      first:
                        type: string
                      last:
                        type: string
                      prev:
                        type: string
                      next:
                        type: string
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: number
                      from:
                        type: number
                      last_page:
                        type: number
                      path:
                        type: string
                      per_page:
                        type: number
                      to:
                        type: number
                      total:
                        type: number
  /products/{id}:
    get:
      summary: '取得單一產品'
      description: 取得單一產品詳細資訊
      tags:
        - Product
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID of product to return
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                        description: 藥品 id
                      sku:
                        type: string
                        description: 藥品 SKU
                      name:
                        type: string
                        description: 藥品名稱
                      unit_id:
                        type: number
                        description: 單位 id
                      qty_available:
                        type: number
                        description: 庫存數量
                      alert_quantity:
                        type: string
                        description: 庫存警告數量
                      unit_short_name:
                        type: string
                        description: 單位簡稱
                      default_sell_price:
                        type: string
                        description: 售價
                      product_custom_field1:
                        type: string
                        description: 藥品證號
                      product_custom_field2:
                        type: string
                        description: 藥品英文名稱
                      product_custom_field3:
                        type: string
                        description: 藥廠
                      product_custom_field4:
                        type: string
                        description: 藥品主成份
  /contacts:
    get:
      summary: 客戶清單
      description: 取得客戶清單
      tags:
        - Contact
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: accountNo  # 身分證字號
          schema:
            type: string
          description: The account number for search contacts
        - in: query
          name: neme  # 姓名
          schema:
            type: string
          description: The name for search contacts
        - in: query
          name: mobile  # 手機號碼
          schema:
            type: string
          description: The mobile for search contacts
        - in: query
          name: keyword  # 關鍵字
          schema:
            type: string
          description: The keyword for search contact's name, mobile and account no
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                          example: 20
                          description: 顧客 id
                        type:
                          type: string
                          example: customer
                          description: 顧客類型(病人 or 購買人)
                        name:
                          type: string
                          example: 王大明
                          description: 顧客名稱
                        mobile:
                          type: string
                          example: 0934987146
                          description: 手機號碼
                        accountNo:
                          type: string
                          example: Z12345678
                          description: 身分證字號
                        created_at:
                          type: string
                          example: 2022-10-21
                          description: 建立日期
                  links:
                    type: object
                    properties:
                      first:
                        type: string
                      last:
                        type: string
                      prev:
                        type: string
                      next:
                        type: string
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: number
                      from:
                        type: number
                      last_page:
                        type: number
                      path:
                        type: string
                      per_page:
                        type: number
                      to:
                        type: number
                      total:
                        type: number
    post:
      summary: '建立病人/購買人資訊'
      description: 建立病人/購買人資訊
      tags:
        - Contact
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Contact'
      responses:
        '200':
          description: Created
  /contacts/{id}:
    get:
      summary: '取得單一客戶資訊'
      description: 取得單一客戶詳細資訊
      tags:
        - Contact
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID of contact to return
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                        example: 20
                        description: 顧客 id
                      type:
                        type: string
                        example: customer
                        description: 顧客類型(病人 or 購買人)
                      identity_id:
                        type: string
                        example: "3412753"
                        description: 身分證字號
                      name:
                        type: string
                        example: A病人
                        description: 顧客名稱
                      gender:
                        type: string
                        example: M
                        description: 性別
                      birthday:
                        type: string
                        example: 2022-09-07
                        description: 生日
                      email:
                        type: string
                        example: allen@nextgen.com.hk
                        description: email
                      mobile: 
                        type: string
                        example: 0934184625
                        description: 手機號碼
                      phoneNumber:
                        type: string
                        example: 07 654876
                        description: 電話號碼
                      address:
                        type: string
                        example: 大安區, 台北市, 台灣 11033
                        description: 地址
                      drugTaBoo:
                        type: string
                        example: 八角
                        description: 藥物忌諱
                      allergyDrugs:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: 藥品ID
                            note:
                              type: string
                              description: 藥品備註
                        example:
                          - id: 2038
                            note: "頭痛"
                          - id: 2058
                            note: "心悸"
                        description: 藥品過敏
                      allergyIngredients:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: 主成份 ID
                            note:
                              type: string
                              description: 主成份過敏備註
                        example:
                          - id: 1038
                            note: "胸痛"
                          - id: 1058
                            note: "眼痛"
                        description: 主成份過敏
                      created_at:
                        type: string
                        example: 2022-10-21
                        description: 建立日期
    put:
      summary: '更新病人/購買人資訊'
      description: 更新病人/購買人資訊
      tags:
        - Contact
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Contact'
      responses:
        '200':
          description: Created
    
