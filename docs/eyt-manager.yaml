openapi: 3.0.1

info:
  title: 醫藥淘
  version: 1.0.0
  description: 醫藥淘 後台相關 api

servers:
  - url: http://localhost:1339/api/
  - url: https://api-dev.e-drugsearch.com.hk/api/

components:
  securitySchemes:
    user_token:
      in: header
      type: apiKey
      name: Authorization
      description: 藥房使用者 驗證需要的 token, Bearer xxx
  parameters:
    language:
      in: header
      name: accept-language
      schema:
        type: string
      required: false
      example: 'zh'
    locale:
      in: query
      name: locale
      schema:
        type: string
        enum: ['zh', 'en', 'zh-CN']
      description: 多語系輸出 繁體中文，英文，簡體中文
      required: false
      example: 'zh'
    storeUUID:
      in: path
      name: uuid
      schema:
        type: string
      required: true
      example: bb9ae68e-e856-41cf-85f6-72f7c7a3716e
      description: 藥房唯一代碼
  schemas:
    store :
      type: object
      properties:
        planType:
          type: string
          description: 方案類型
        adType:
          type: string
          description: 廣告類型
        stockType:
          type: string
          description: 庫存類型
        stockUrl:
          type: string
          description: 庫存 api
        stockSyncParams:
          type: object
          description: 庫存 api 額外參數
        tel:
          type: string
          description: 聯絡電話
          example: '1234567890'
        type:
          type: string
          description: 類型
        isExcellent:
          type: boolean
          example: false
        isGenuine:
          type: boolean
          example: true
        rxNo:
          type: string
          description: rxNo
        name:
          type: object
          description: 藥局名稱(中文}
          properties:
            zh:
              type: string
              example: '良躍社區藥房'
            zh-CN:
              type: string
              example: '良跃社区药房'
            en:
              type: string
              example: 'A-LIVELY COMMUNITY PHARMACY O/B ABERDEEN KAI-FONG WELFARE ASSOCIATION LIMITED'
        contactNumber:
          type: string
          description: 聯絡電話
        address:
          type: object
          description: 地址
          properties:
            zh:
              type: string
              example: '安和路'
            zh-CN:
              type: string
              example: '安和路'
            en:
              type: string
              example: 'Anhe Road'
        lat:
          type: string
          description: 緯度
          example: 22.25193195
        lng:
          type: string
          description: 經度
          example: 114.13825551
        area:
          type: number
          description: 區域
          example: 1
        district:
          type: number
          description: 行政區域
          example: 1
        businessHours:
          type: string
          description: 營業時間
        openingHours:
          type: array
          items:
            type: object
          description: 營業時間
          example: [{'id':1, 'weekday': 1, "startTime": "00:00:00", "endTime": "12:00:00"}]       
        website:
          type: string
          description: 網站
        content:
          type: object
          description: 網站內容
          properties:
            zh:
              type: string
            zh-CN:
              type: string
            en:
              type: string
        tags:
          type: array
          items:
            type: integer
          description: tag id
          example: [1,2,3]
        mainServices:
          type: array
          items:
            type: integer
          description: mainServices id
          example: [1,2,3]
        services:
          type: array
          items:
            type: integer
          description: tag id
          example: [1,2,3]
        images:
          type: array
          items:
            type: integer
          description: image id
          example: [1,2,3]
        plan:
          type: object
    OptionsBaseResponse:
      type: object
      properties:
        msg :
          type: string
          example: Success
        data:
          type: array
          items:
            type: object
            properties:
              key:
                type: number
                description: 用來執行搜尋用的參數
                example: 1
              value:
                type: string
                description: 顯示名稱
                example: 名稱

paths:
  # ====================
  #
  # other
  #
  /upload:
    post:
      summary: 上傳檔案
      tags:
        - other
      security:
        - user_token: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: string
                  format: binary
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    name:
                      type: string
                    alternativeText:
                      type: string
                      nullable: true
                    caption:
                      type: string
                      nullable: true
                    width:
                      type: number
                    height:
                      type: number
                    formats:
                      type: object
                      properties:
                        large:
                          type: object
                          properties:
                            ext:
                              type: string
                            url:
                              type: string
                            hash:
                              type: string
                            mime:
                              type: string
                            name:
                              type: string
                            path:
                              type: string
                              nullable: true
                            size:
                              type: number
                            width:
                              type: number
                            height:
                              type: number
                        small:
                          type: object
                          properties:
                            ext:
                              type: string
                            url:
                              type: string
                            hash:
                              type: string
                            mime:
                              type: string
                            name:
                              type: string
                            path:
                              type: string
                              nullable: true
                            size:
                              type: number
                            width:
                              type: number
                            height:
                              type: number
                        medium:
                          type: object
                          properties:
                            ext:
                              type: string
                            url:
                              type: string
                            hash:
                              type: string
                            mime:
                              type: string
                            name:
                              type: string
                            path:
                              type: string
                              nullable: true
                            size:
                              type: number
                            width:
                              type: number
                            height:
                              type: number
                        thumbnail:
                          type: object
                          properties:
                            ext:
                              type: string
                            url:
                              type: string
                            hash:
                              type: string
                            mime:
                              type: string
                            name:
                              type: string
                            path:
                              type: string
                              nullable: true
                            size:
                              type: number
                            width:
                              type: number
                            height:
                              type: number
                    hash:
                      type: string
                    ext:
                      type: string
                    mime:
                      type: string
                    size:
                      type: number
                    url:
                      type: string
                    previewUrl:
                      type: string
                      nullable: true
                    provider:
                      type: string
                    provider_metadata:
                      type: string
                      nullable: true
                    createdAt:
                      type: string
                    updatedAt:
                      type: string

  # ====================
  #
  # posts
  #

  /admin/posts:
    get:
      summary: 獲取後台文章列表及審核文章列表
      security:
        - user_token: []
      tags:
        - posts
      parameters:
        - in: header
          name: accept-language
          schema:
            type: string
            enum: [ zh, zh-CN, en]
          description: 文章的語言 
        - in: query
          name: reviewStatus
          schema:
            type: string
            enum: [pending,reviewed,reviewArchived]
          required: false
          description: 搜尋審核文章列表時必須要帶此query 
        - in: query
          name: listStatus
          schema:
            type: string
            enum: [listArchived,review,draft,rejected]
          required: false
          description:  搜尋文章列表時必須要帶此query                     
        - in: query
          name: keyword
          schema:
            type: string
          description: 關鍵字搜尋(title,  store)-模糊搜尋
        - in: query
          name: firstCategory
          schema:
            type: string
          description: 第一層分類篩選
        - in: query
          name: secondCategory
          schema:
            type: string
          description: 第二層分類篩選          
        - in: query
          name: startTime
          schema:
            type: string
            minimum: 1
          description: 篩選功能(起始時間)   
        - in: query
          name: endTime
          schema:
            type: string
          description: 篩選功能(結束時間)   
        - in: query
          name: type
          schema:
            type: string
            minimum: 1
          description: 篩選功能-文章分類  
        - in: query
          name: pageSize
          schema:
            type: integer
          description: 單頁筆數
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: 第幾頁                               
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        uuid:
                          type: string
                        title:
                          type: string
                        type:
                          type: object
                          description: 文章類別
                          properties:
                            id:
                              type: number
                            name:
                              type: string
                        categories:
                          type: array
                          description: 文章分類
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              name:
                                type: string
                        store:
                          type: object
                          description: 公司名稱
                          properties:
                            uuid:
                              type: string
                            name:
                              type: string
                        status:
                          type: string
                        editor:
                          type: string
                          description: 編輯者
                        date:
                          type: string
                        image:
                          type: string
                        reasonForReject:
                          type: string
                          description: 文章退件原因
                  pagination:
                    type: object
                    properties:
                      page:
                        type: number
                        description: 當前頁面
                      pageSize:
                        type: number
                        description: 每頁筆數
                      pageCount:
                        type: number
                        description: 總共頁數
                      total:
                        type: number
                        description: 總共筆數

  /admin/posts/{uuid}:
    get:  
      summary: 後台獲取指定文章
      security:
        - user_token: []
      tags:
        - posts
      parameters:
        - name: uuid
          in: path
          description: 文章uuid
          required: true
          example: e6d37477-7224-4fb6-a56a-d860228d48f4
          schema:
            type: string
      responses:  
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      uuid:
                        type: string
                      title:
                        type: string
                      content:
                        type: string
                      publishType:
                        type: string
                      publishStart:
                        type: string
                      publishEnd:
                        type: string
                      seoDescription:
                        type: string
                      urlSuffix:
                        type: string
                      image:
                        type: object
                        properties:
                          id:
                            type: number
                          url:
                            type: string
                      store:
                        type: object
                        properties:
                          id:
                            type: number
                          name:
                            type: string
                      editor:
                        type: object
                        properties:
                          id:
                            type: number
                          email:
                            type: string
                      localizations:
                        type: array
                        items:
                          type: object
                          properties:
                            uuid:
                              type: string
                            locale:
                              type: string
                      type:
                        type: object
                        properties:
                          id:
                            type: number
                          name:
                            type: string
                      categories:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            name:
                              type: string
                      tags:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            name:
                              type: string         

  /admin/checkDuplicates:
    post:
      summary: 確認特定屬性是否重複（當前僅用來確認urlSuffix)
      security:
        - user_token: []
      tags:
        - posts
      requestBody:
        required: true
        content:
           application/json:
            schema:
              type: object
              properties:
                urlSuffix:
                  type: string
                  description: 後綴網址檢查

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  /admin/posts/stores:
    get:
      summary: 獲取後台發布者id及name
      security:
        - user_token: []
      tags:
        - posts 
      parameters:
        - in: header
          name: accept-language
          schema:
            type: string
            enum: [ zh, zh-CN, en]
          description: 文章類別的語言                                
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        name:
                          type: string   

  /admin/postTags:
    get:
      summary: 獲取後台文章類別
      security:
        - user_token: []
      tags:
        - posts 
      parameters:
        - in: header
          name: accept-language
          schema:
            type: string
            enum: [ zh, zh-CN, en]
          description: 文章類別的語言
        - in: query
          name: type
          schema:
            type: string
            enum: [post_categories, hashTag, post_type ]
          description: 搜尋的哪一種類型的tag, 分類，標籤，類別，預設是標籤         
        - in: query
          name: category_id
          schema:
            type: string
          description: 第一層分類id（搜尋第二層分類）                                  
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        name:
                          type: string                 、

  /admin/create/posts:
    post:
      summary: 後台建立文章
      security:
        - user_token: []
      tags:
        - posts
      requestBody:
        required: true
        content:
           application/json:
            schema:
              type: object
              properties:
                content:
                  type: object
                  properties:
                    zh:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                    zh-CN:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                    en:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                urlSuffix:
                  type: string
                publishType:
                  type: string
                publishStart:
                  type: string
                publishEnd:
                  type: string
                publisher:
                  type: string
                type:
                  type: string
                firstCategory:
                  type: string
                secondCategory:
                  type: string
                tags:
                  type: string
                store:
                  type: string
                status:
                  type: string
              required:
                - content
                - tags
                - firstCategory
                - urlSuffix
                - type

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  /admin/update/posts:
    post:
      summary: 後台更新文章
      security:
        - user_token: []
      tags:
        - posts
      requestBody:
        required: true
        content:
           application/json:
            schema:
              type: object
              properties:
                content:
                  type: object
                  properties:
                    zh:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                        uuid:
                          type: string
                    zh-CN:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                        uuid:
                          type: string
                    en:
                      type: object
                      properties:
                        title:
                          type: string
                        content:
                          type: string
                        seoDescription:
                          type: string
                        image:
                          type: number
                        uuid:
                          type: string  
                urlSuffix:
                  type: string
                publishType:
                  type: string
                publishStart:
                  type: string
                publishEnd:
                  type: string
                publisher:
                  type: string
                type:
                  type: string
                firstCategory:
                  type: string
                secondCategory:
                  type: string
                tags:
                  type: string
                store:
                  type: string
                status:
                  type: string
              required:
                - content
                - tags
                - firstCategory
                - urlSuffix
                - type

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  # ====================
  #
  # stores
  #
  /admin/search/stores:
    get:
      summary: 藥房
      tags:
        - stores
      security:
        - user_token: []
      parameters:
        - in: query
          name: type
          schema:
            type: string
          description: 類型
        - in: query
          name: area
          schema:
            type: string
          description: 指定搜尋區域
        - in: query
          name: district
          explode: true
          schema:
            type: string
          description: 指定行政區
        - in: query
          name: adType
          explode: true
          schema:
            type: string
          description: 廣告類型
        - in: query
          name: stockType
          explode: true
          schema:
            type: string
          description: 庫存類型
        - in: query
          name: status
          explode: true
          schema:
            type: string
          description: 狀態
        - in: query
          name: keyword
          schema:
            type: string
          description: 藥房名稱(中英), 電話, 地址
        - in: query
          name: perPage
          schema:
            type: integer
          description: 每頁筆數
        - in: query
          name: page
          schema:
            type: integer
          description: 頁碼
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string
                    data:
                          type: array
                          items:
                            type: object
                            properties:
                              uuid:
                                type: string
                              imgUrl:
                                type: string
                              name:
                                type: string
                              area:
                                type: string
                              district:
                                type: string
                              address:
                                type: string
                              type:
                                type: string
                              adType:
                                type: string
                              stockType:
                                type: string
                              status:
                                type: boolean
                    pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            description: 起始頁數
                            example: 1
                          pageSize:
                            type: integer
                            description: 每頁資料筆數
                            example: 10
                          pageCount:
                            type: integer
                            description: 總頁數
                            example: 23
                          total:
                            type: integer
                            description: 總筆數
                            example: 236

  /admin/stores/detail/{uuid}:
    get:
      summary: 藥房
      tags:
        - stores
      security:
        - user_token: []
      parameters:
        - $ref: '#/components/parameters/storeUUID'
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string
                    data:
                      type: object
                      properties:
                        uuid:
                          type: string
                        stockType:
                          type: string
                        name:
                          type: object
                          properties:
                            zh:
                              type: string
                            zh-CN:
                              type: string
                            en:
                              type: string
                        address:
                          type: object
                          properties:
                            zh:
                              type: string
                            zh-CN:
                              type: string
                            en:
                              type: string
                        lat:
                          type: number
                        lng:
                          type: number
                        contactNumber:
                          type: string
                        businessHours:
                          type: string
                        openingHours:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              weekday:
                                type: number
                              startTime:
                                type: string
                              endTime:
                                type: string
                        isExcellent:
                          type: boolean
                        isGenuine:
                          type: boolean
                        website:
                          type: string
                        plan:
                          type: string
                        planType:
                          type: string
                        content:
                          type: object
                          properties:
                            zh:
                              type: string
                            zh-CN:
                              type: string
                            en:
                              type: string
                        area:
                          type: object
                          properties:
                            id:
                              type: number
                            name:
                              type: string
                        district:
                          type: object
                          properties:
                            id:
                              type: number
                            name:
                              type: string
                        tags:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              name:
                                type: string
                        mainServices:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              name:
                                type: string
                        services:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              name:
                                type: string
                        images:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: number
                              url:
                                type: string

  /admin/stores/{uuid} :
    post:
      summary: 修改 藥房
      tags:
        - stores
      security:
        - user_token: []
      parameters:
        - $ref: '#/components/parameters/storeUUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/store'
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string

  /admin/stores/uuid:
    get:
      summary: 取得新藥房 uuid
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string
                    data:
                      type: string
                      example: 0089adf3-187e-4882-b831-e5eb6612f587

  /admin/stores/:uuid/create:
    post:
      summary: 新增 藥房
      tags:
        - stores
      security:
        - user_token: []
      parameters:
        - $ref: '#/components/parameters/storeUUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/store'
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string

  /admin/stores/options/planTypes:
    get:
      summary: 藥房 方案
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/adTypes:
    get:
      summary: 藥房廣告類型
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/stockTypes:
    get:
      summary: 藥房庫存方案
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/tags:
    get:
      summary: 藥房 Tags
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/mainServices:
    get:
      summary: 藥房 主要服務
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/services:
    get:
      summary: 藥房 服務
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'

  /admin/stores/options/districts:
    get:
      summary: 取的香港行政區域
      tags:
        - stores
      security:
        - user_token: []
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/OptionsBaseResponse'