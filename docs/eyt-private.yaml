openapi: 3.0.1

info:
  title: 醫藥淘
  version: 1.0.0

servers:
  - url: http://localhost:1339/api/
  - url: https://api-dev.e-drugsearch.com.hk/api/

components:
  securitySchemes:
    user_token:
      in: header
      type: apiKey
      name: Authorization
      description: 藥房使用者 驗證需要的 token, Bearer xxx
    member_token:
      in: header
      type: apiKey
      name: Authorization
      description: member 驗證需要的 token, Bearer xxx
  parameters:
    visitor:
      in: header
      name: visitor
      schema:
        type: string
      required: true
      example: false663c8908-c8f8-4ea2-8869-5b1f42819a51
      description: visitor token，參數來源為 api/visitor/token 輸出的 data
    page:
      in: query
      name: pagination[page]
      schema:
        type: number
      required: true
      example: 1
    prepage:
      in: query
      name: pagination[pageSize]
      schema:
        type: number
      required: true
      example: 100
    language:
      in: header
      name: accept-language
      schema:
        type: string
      required: false
      example: 'en'
    isCollect:
      in: query
      name: isCollect
      schema:
        type: integer
        enum: [0,1]
      required: false
      description: 是否已收藏，isCollect=1 ，已收藏
      example: 0
  schemas:
    ProductsResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: number
                description: 藥品 id
              sku:
                type: string
                description: 藥品 SKU
              name:
                type: string
                description: 藥品名稱
              qty_available:
                type: number
                description: 庫存數量
              alert_quantity:
                type: string
                description: 庫存警告數量
              default_sell_price:
                type: string
                description: 售價
              product_custom_field1:
                type: string
                description: 藥品證號
              product_custom_field2:
                type: string
                description: 藥品英文名稱
              product_custom_field3:
                type: string
                description: 藥廠
              product_custom_field4:
                type: string
                description: 藥品主成份
    SingleProductResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: number
              description: 藥品 id
            sku:
              type: string
              description: 藥品 SKU
            name:
              type: string
              description: 藥品名稱
            unit_id:
              type: integer
              description: 單位ID
            qty_available:
              type: number
              description: 庫存總數量
            alert_quantity:
              type: string
              description: 庫存警告數量
            unit_short_name:
              type: string
              description: 單位簡稱
            product_custom_field1:
              type: string
              description: 藥品證號
            product_custom_field2:
              type: string
              description: 藥品英文名稱
            product_custom_field3:
              type: string
              description: 藥廠
            product_custom_field4:
              type: string
              description: 藥品主成份
            stock:
              type: array
              items:
                type: object
                properties:
                  variation_id:
                    type: integer
                    description: 規格ID
                  unit_name:
                    type: string
                    description: 單位名稱
                  default_sell_price:
                    type: string
                    description: 售價(不含稅)
                  qty_available:
                    type: string
                    description: 庫存數量
    DrugOptionsResponse:
      type: object
      properties:
        msg :
          type: string
        data:
          type: array
          items:
            type: object
            properties:
              key:
                type: string
                description: 用來執行搜尋用的參數
              value:
                type: string
                description: 顯示名稱

paths:

  # ====================
  #
  # Member
  #

  /members/{uuid}:
    get:
      summary: 拿會員中心顯示的個人資料
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                      member:
                        type: object
                        properties:
                          id:
                            type: number
                          createdAt:
                            type: string
                          name:
                            type: string
                          mobile:
                            type: string
                          email:
                            type: string
                          fax:
                            type: string
                          uuid:
                            type: string
    put:
      summary: 修改會員資料
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: name
                fax:
                  type: string
                  description: fax
                mobile:
                  type: string
                  description: mobile
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                      member:
                        type: object
                        properties:
                          id:
                            type: number
                          createdAt:
                            type: string
                          name:
                            type: string
                          mobile:
                            type: string
                          email:
                            type: string
                          fax:
                            type: string
                          uuid:
                            type: string
    delete:
      summary: 註銷會員
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
        - in: query
          name: confirm
          required: true
          schema:
            type: string
          description: 讓會員輸入 DELETE 確認要註銷帳號
          example: DELETE
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example: Success

  /members/{uuid}/avatar:
    post:
      summary: member 上傳頭像
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - name: uuid
          in: path
          required: true
          schema:
            type: string
          description: member uuid
      requestBody:
        required: false
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      avatar:
                        type: object
                        properties:
                          id:
                            type: number
                          name:
                            type: string
                          alternativeText:
                            type: string
                          caption:
                            type: string
                          width:
                            type: number
                          height:
                            type: number
                          formats:
                            type: string
                          hash:
                            type: string
                          ext:
                            type: string
                          mime:
                            type: string
                          size:
                            type: number
                          url:
                            type: string
                          previewUrl:
                            type: string
                          provider:
                            type: string
                          provider_metadata:
                            type: string
                          createdAt:
                            type: string
                          updatedAt:
                            type: string
    delete:
      summary: 移除 member 頭像
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: Success

  /members/me:
    get:
      summary: refresh member
      tags:
        - members
      security:
        - member_token: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      member:
                        type: object
                        properties:
                          id:
                            type: number
                          uuid:
                            type: string
                          name:
                            type: string
                          email:
                            type: string
                          avatar:
                            type: string
                            example: "https://s3.ap-southeast-1.amazonaws.com/medicine-s3.cloudsatlas.com.hk/2023_05_10_4_24_27_175189b4cb.png"



  /members/{uuid}/third-party-logins:
    get:
      summary: 拿會員有連結的第三方登入資料
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                      thirdPartyLogins:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            platform:
                              type: string
                            openId:
                              type: string
                            email:
                              type: string

  /members/{uuid}/reset-password:
    put:
      summary: 修改會員密碼
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: member uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                oldPassword:
                  type: string
                  description: 舊密碼
                newPassword:
                  type: string
                  description: 新密碼
                confirmNewPassword:
                  type: string
                  description: 確認新密碼，值要跟新密碼一樣
      responses:
        '200':
          description: 成功
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string


  /members/oauth/{provider}/{action}/{from}:
    post:
      summary: apple, facebook, google, wechat 的第三方登入 callback 打這支
      tags:
        - members
      parameters:
        - in: path
          name: provider
          required: true
          schema:
            type: string
          description: 全小寫，完整名稱。
          example: facebook
        - in: path
          name: action
          required: true
          schema:
            type: string
          description: 這次動作是 login 或 新增綁定
          example: login
        - in: path
          name: from
          required: true
          schema:
            type: string
          description: web or app
          example: web
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: wechat 要帶 code
                idToken:
                  type: string
                  description: apple, facebook, google 要帶 idToken
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      action:
                        type: string
                      msg:
                        type: string
                      sessionId:
                        type: string

    get:
      summary: ig 的第三方登入 callback 打這支
      tags:
        - members
      security:
        - client_token: []
      parameters:
        - in: path
          name: provider
          required: true
          schema:
            type: string
          description: 全小寫，完整名稱。
          example: instagram
        - in: path
          name: action
          required: true
          schema:
            type: string
          description: 這次動作是 login 或 新增綁定
          example: login
        - in: path
          name: from
          required: true
          schema:
            type: string
          description: web or app
          example: web
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: wechat 要帶 code
      responses:
        '302':
          description: Redirect
          headers:
            Location:
              description: The new URL to redirect to.
              schema:
                type: string
                example: https://dev.e-drugsearch.com.hk/oauth

  /members/third-party-callback:
    post:
      summary: 第三方綁定或登入
      description: 舊用戶第三方登入 or 新用戶第三方註冊 or 舊用戶綁定新的第三方(這個要帶 header) 三個都是打這支
      tags:
        - members
      security:
        - member_token: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                  description: oauth 那支跟後端拿到的 sessionId
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                      jwt:
                        type: string
                      member:
                        type: object
                        properties:
                          id:
                            type: number
                          uuid:
                            type: string
                          name:
                            type: string
                          email:
                            type: string
                          avatar:
                            type: string
                      thirdPartyLogin:
                        type: object
                        properties:
                          id:
                            type: number
                          platform:
                            type: string
                          openId:
                            type: string
                          email:
                            type: string

  /members/third-party-logins/{openId}:
    delete:
      summary: 刪除第三方綁定
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: openId
          required: true
          schema:
            type: string
          example: 000332.954c3605e5c14549be066a32f4cb3175.0703
          description: openId
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  /members/search/history/:type:
    get:
      summary: 會員搜尋記錄
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: type
          required: true
          schema:
            type: string
            enum: [all, drug, store, post, stock]
          example: web
          description: 記錄類型
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        uuid:
                          type: string
                          example: 68f2a709-e4cd-4f53-9936-dadcc02045c4
                          description: 唯一識別碼
                        type:
                          type: string
                          example: drug
                          description: 記錄類型
                        keyword:
                          type: string
                          example: 港九
                          description: 關鍵字
                        options:
                          type: object
                          properties:
                            permitNo:
                              type: array
                              items:
                                type: string
                              example: [HK-44731, HK-45577]
                              description: 僅記錄類為 stock 才會有
                        createdAt:
                          type: string
                          example: 2023-05-17T09:43:09.944Z
                          description: 建立時間

  /members/search/repeat/:uuid:
    get:
      summary: 重複搜尋
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          example: 9d86687a-0c2f-47e2-9989-ecbcf01ae4c2
          description: 記錄類型
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: array
                    items:
                      type: object


  /members/search/history/clear/:type:
    delete:
      summary: 清空會員搜尋記錄
      tags:
        - members
      security:
        - member_token: []
      parameters:
        - in: path
          name: type
          required: true
          schema:
            type: string
            enum: [all, drug, store, post, stock]
          example: web
          description: 記錄類型
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  # ====================
  #
  # posts
  #

  /search/posts:
    post:
      summary: 記錄 log  文章
      tags:
        - posts
      security:
        - member_token: []
      parameters:
        - in: query
          name: keyword
          schema:
            type: string
          description: 關鍵字搜尋(title, content, tags, store, type)-模糊搜尋                          
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string

  /add/posts:
    post:
      summary: 建立文章
      tags:
        - posts
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: 文章標題
                content:
                  type: string
                  description: 文章內容
                store:
                  type: number
                  description: 該文章是屬於哪一個供應商，當前因無後台機制故先寫死
                  example: 1
                type:
                  type: string
                  example: 藥物新知
                  description: 文章類別
                locale:
                  type: string
                  enum: ['zh', 'en', 'zh-CN']
                  description: 文章語言，上面分別對應 繁體中文，英文，簡體中文
                image:
                  type: string
                  example: binary
                  description: 文章圖片 
                sort:
                  type: number        
                  description: 排序順序
                  example: 999     
                publishStart:
                  type: string
                  description: 預計上架時間（實際功能會到 phaseII 實作）
                publishEnd:
                  type: number
                  description: 預計下架時間（實際功能會到 phaseII 實作）

              required:
                - title
                - store
                - type
                - locale
                - image

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      title:
                        type: string
                        description: 文章標題
                      content:
                        type: string
                        description: 文章內容
                      store:
                        type: string
                        description: 發布來源
                      type:
                        type: string
                        description: 文章類別（大標）
                      sort:
                        type: number
                        description: 文章排序的值
                      viewCount:
                        type: number
                        description: 文章瀏覽數
                      isApproved:
                        type: boolean
                        description: 文章是否已核准（核轉狀態下才會出現在前台）
                      isDeleted:
                        type: boolean
                      publishStart:
                        type: string
                      publishEnd:
                        type: string
                      locale:
                        type: string
                        description: 文章語系
                      image:
                        type: string
                        description: 文章圖片

        '500':
          description: 伺服器錯誤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  伺服器錯誤
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  建立失敗                              

  /update/posts/{id}:    
    # review
    put:
      summary: 更新指定文章
      tags:
        - posts
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: post id
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: 文章標題
                content:
                  type: string
                  description: 文章內容
                store:
                  type: number
                  description: 該文章是屬於哪一個供應商，當前因無後台機制故先寫死
                  example: 1
                type:
                  type: string
                  example: 藥物新知
                  description: 文章類別
                locale:
                  type: string
                  enum: ['zh', 'en', 'zh-CN']
                  description: 文章語言，上面分別對應 繁體中文，英文，簡體中文
                image:
                  type: string
                  example: binary
                  description: 文章圖片 
                sort:
                  type: number        
                  description: 排序順序
                  example: 999     
                publishStart:
                  type: string
                  description: 預計上架時間（實際功能會到 phaseII 實作）
                publishEnd:
                  type: number
                  description: 預計下架時間（實際功能會到 phaseII 實作）

              required:
                - title
                - store
                - type
                - locale
                - image

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      title:
                        type: string
                        description: 文章標題
                      content:
                        type: string
                        description: 文章內容
                      store:
                        type: string
                        description: 文章來源
                      type:
                        type: string
                        description: 文章類別（大標）
                      sort:
                        type: number
                        description: 文章排序值
                      viewCount:
                        type: number
                        description: 文章瀏覽數
                      isApproved:
                        type: boolean
                      isDeleted:
                        type: boolean
                      publishStart:
                        type: string
                      publishEnd:
                        type: string
                      createdAt:
                        type: string
                      updatedAt:
                        type: string
                      locale:
                        type: string
                        description: 文章語系
                      image:
                        type: string
                        description: 文章圖片
                      tags:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            tagName:
                              type: string  

        '500':
          description: 伺服器錯誤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  伺服器錯誤
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  建立失敗      

  /collect/posts/{id}:  
    post:
      summary: 收藏文章
      tags:
        - posts
      security:
        - member_token: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: post id                    

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏文章成功
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏文章失敗            

  /cancel/posts/{id}:  
    put:
      summary: 取消收藏文章
      tags:
        - posts
      security:
        - member_token: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: post id                    

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 取消收藏！                           


  # ====================
  #
  # tags
  #

  /add/tags:
    post:
      summary: 建立tag
      tags:
        - tags
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                parent:
                  type: number
                  description: 標籤的父層
                tagName:
                  type: string
                  description: 標籤名稱
                type:
                  type: string
                  description: 該標籤是屬於分類還是一般標籤，default為 hashTag，分類則帶值categories
                  example: categories
                locale:
                  type: string
                  enum: ['zh', 'en', 'zh-CN']
                  description: 文章語言，上面分別對應 繁體中文，英文，簡體中文

              required:
                - tagName
                - locale

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      tagName:
                        type: string
                      parent:
                        type: object
                        properties:
                          id:
                            type: number
                            description: 父層tag的名稱（只會有一個父層）
                          tagName:
                            type: string
                            description: 父層tag的名稱（只會有一個父層）
                      children:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                              description: 子層tag的名稱
                            tagName:
                              type: string
                              description: 子層tag的名稱

        '500':
          description: 伺服器錯誤
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  伺服器錯誤
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      msg:
                        type: string
                        example:  建立失敗              

  /update/tags/{id}:
    put:
      summary: 修改tag
      tags:
        - tags
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                parent:
                  type: number
                  description: 標籤的父層
                tagName:
                  type: string
                  description: 標籤名稱
                type:
                  type: number
                  description: 該標籤是屬於分類還是一般標籤，default為 hashTag，分類則帶值categories
                  example: hashTag
                locale:
                  type: string
                  enum: ['zh', 'en', 'zh-CN']
                  description: 文章語言，上面分別對應 繁體中文，英文，簡體中文

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      tagName:
                        type: string
                      type:
                        type: string
                      parent:
                        type: object
                        properties:
                          id:
                            type: number
                          tagName:
                            type: string
                      children:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: number
                            tagName:
                              type: string

  # ====================
  #
  # subscribes
  #
  /member/subscribe/list:
    get:
      summary: 獲取該會員的訂閱相關資訊
      tags:
        - subscribe
      security:
        - member_token: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      emails:
                        type: array
                        items:
                          type: string
                      isSubscribed:
                        type: boolean
                      uuid:
                        type: string
                      types:
                        type: array
                        items:
                          type: string
                      tags:
                        type: array
                        items:
                          type: string

  /member/subscribe:
    post:
      summary: 會員訂閱
      tags:
        - subscribe
      security:
        - member_token: []        
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: 訂閱的信箱
                types:
                  type: string
                  description: 追蹤的來源
                  example: 1,2,3
                tags:
                  type: string
                  description: 追蹤的分類
                  example: 2,4,7
                isSubscribed:
                  type: boolean
                  description: 是否開啟訂閱

              required:
                - email
 
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      emails:
                        type: array
                        items:
                          type: string
                      isSubscribed:
                        type: boolean
                      uuid:
                        type: string
                      types:
                        type: array
                        items:
                          type: string
                      tags:
                        type: array
                        items:
                          type: string

  /member/subscribe/:uuid:
    put:
      summary: 更新訂閱的選項
      tags:
        - subscribe
      security:
        - member_token: []        
      parameters:
        - name: uuid
          in: path
          description: 訂閱的uuid
          required: true
          example: f6bd3fe9-62ae-4f68-9a78-5779880571812
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: 訂閱的信箱
                types:
                  type: string
                  description: 追蹤的來源
                  example: 1,2,3
                tags:
                  type: string
                  description: 追蹤的分類
                  example: 2,4,7
                isSubscribed:
                  type: boolean
                  description: 是否開啟訂閱
                   
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: number
                      emails:
                        type: array
                        items:
                          type: string
                      isSubscribed:
                        type: boolean
                      uuid:
                        type: string
                      types:
                        type: array
                        items:
                          type: number
                      tags:
                        type: array
                        items:
                          type: number

  # ====================
  #
  # drug
  #
  /collect/drugs/:permit_no:
    post:
      summary: 收藏藥品
      tags:
        - drug
      security:
        - member_token: []
      parameters:
        - in: path
          name: permit_no
          required: true
          schema:
            type: string
          description: permit_no
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏成功
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏失敗            

  /collect/drugs/:permit_no/cancel:
    put:
      summary: 取消收藏
      tags:
        - drug
      security:
        - member_token: []
      parameters:
        - in: path
          name: permit_no
          required: true
          schema:
            type: string
          description: permit_no

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 取消收藏！

  /search/drugs:
    post:
      summary: 藥品搜尋(keyword log)
      tags:
        - drug
      security:
        - member_token: []
      parameters:
        - $ref: '#/components/parameters/visitor'
        - $ref: '#/components/parameters/isCollect'
        - in: query
          name: ingredient
          schema:
            type: integer
          description: 藥品成分 id
        - in: query
          name: holder
          schema:
            type: integer
          description: 證書持有人id
        - in: query
          name: tags
          schema:
            type: string
          description: 藥品分類
        - in: query
          name: saleRequirement
          schema:
            type: string
          description: 銷售要求
        - in: query
          name: legalClassification
          schema:
            type: integer
          description: 藥品管制分類
        - in: query
          name: brand
          schema:
            type: integer
          description: 品牌
        - in: query
          name: name
          schema:
            type: string
          description: 藥品名稱
        - in: query
          name: prefixName
          schema:
            type: string
          description: 藥品字首
        - in: query
          name: permitNo
          schema:
            type: string
          description: permit No
        - in: query
          name: keyword
          schema:
            type: string
          description: 藥品名稱(中英), 名稱, 核准碼, 主成份, SKU
        - in: query
          name: sort
          schema:
            type: string
            enum: [nameAsc, nameDesc,collectDesc]
          description: 排序功能
        - in: query
          name: perPage
          schema:
            type: integer
          description: 每頁筆數
        - in: query
          name: page
          schema:
            type: integer
          description: 頁碼
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg :
                      type: string

  # ====================
  #
  # store
  #
  /collect/stores/:uuid:
    post:
      summary: 收藏藥房
      tags:
        - store
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: 藥房uuid
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏成功
        '400':
          description: 失敗
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 收藏失敗            

  /collect/stores/:uuid/cancel:
    put:
      summary: 取消收藏
      tags:
        - store
      security:
        - member_token: []
      parameters:
        - in: path
          name: uuid
          required: true
          schema:
            type: string
          description: 藥房uuid

      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                    example: 取消收藏！

  /search/stores:
    post:
      summary: 記錄藥房收尋(keyword log)
      tags:
        - stores
      security:
        - member_token: []
      parameters:
        - $ref: '#/components/parameters/visitor'
        - $ref: '#/components/parameters/isCollect'
        - in: query
          name: isGenuine
          schema:
            type: string
          description: 正版正貨 0,1
        - in: query
          name: isExcellent
          schema:
            type: string
          description: 信心保證 0,1
        - in: query
          name: tags
          schema:
            type: string
          description: tags 篩選
        - in: query
          name: mainServices
          schema:
            type: string
          description: 主要服務篩選
        - in: query
          name: services
          schema:
            type: integer
          description: 服務篩選
        - in: query
          name: stockType[]
          schema:
            type: array
            items:
              type: string
            description: 庫存類型 lv1,lv2,lv3
            example: ['lv1', 'lv2']
        - in: query
          name: area
          schema:
            type: string
          description: 指定搜尋區域
        - in: query
          name: district
          explode: true
          schema:
            type: string
          description: 指定行政區
        - in: query
          name: keyword
          schema:
            type: string
          description: 藥房名稱(中英), 電話, 區域, 分區, 地址, 主要服務項目, 服務項目, tags
        - in: query
          name: sort
          schema:
            type: string
            enum: [nameAsc, nameDesc,collectDesc]
          description: 排序功能
        - in: query
          name: perPage
          schema:
            type: integer
          description: 每頁筆數
        - in: query
          name: page
          schema:
            type: integer
          description: 頁碼
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string

  /stores/medicines:
    post:
      summary: 哪裡買藥(keyword log)
      tags:
        - stores
      security:
        - member_token: []
      parameters:
        - $ref: '#/components/parameters/visitor'
        - in: query
          name: permitNo
          schema:
            type: array
            items:
              type: string
          description: 藥品
          example: ['HK-05357', 'HK-07007']
        - in: query
          name: isExact
          schema:
            type: integer
            enum: [0,1]
          description: 藥品使否要完整符合
        - in: query
          name: stockType[]
          schema:
            type: array
            items:
              type: string
            description: 庫存類型 lv1,lv2,lv3
            example: ['lv1', 'lv2']
        - in: query
          name: district
          explode: true
          schema:
            type: array
            items:
              type: string
          description: 指定行政區
        - in: query
          name: area
          schema:
            type: string
          description: 指定搜尋區域
        - in: query
          name: lat
          schema:
            type: integer
          description: 緯度
        - in: query
          name: lng
          schema:
            type: integer
          description: 經度
      responses:
          '200':
            description: 成功
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    msg:
                      type: string
